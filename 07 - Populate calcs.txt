Option Compare Database

Sub populate_calculation()

    ' ===== Populating Active_Q1-Q4 columns (in table: STATIC_DATA) with decimal figure representing how much of the quarter has been charged =====
    ' ===== E.g. 1 = Whole quarter charged. 0 = Whole quarter not charged. 0.5 = half of quarter charged. =====
    ' ===== Note: the calculation for 1Q16 and 2Q16 are different from the calculation for other quarters =====

    DoCmd.SetWarnings False

        Dim sqlrun As String
        
' ===================================================================

'Q1
    'New_root
        ' Inserting root into New_root col:
        sqlrun = "INSERT INTO CALCULATION_Q1 (New_root) SELECT DISTINCT New_root FROM AAA_AUM_Q1;"
        DoCmd.RunSQL (sqlrun)

    'Asset value
        ' Creating temporary table
        sqlrun = "SELECT AAA_AUM_Q1.New_root, Sum(AAA_AUM_Q1.value) AS Sum_of_value INTO tmp_VALUE_SUM_Q1 FROM AAA_AUM_Q1 GROUP BY AAA_AUM_Q1.New_root;"
        DoCmd.RunSQL (sqlrun)
        
        ' Placing contents of temporary table onto Calculation table
        sqlrun = "UPDATE tmp_VALUE_SUM_Q1 INNER JOIN CALCULATION_Q1 ON tmp_VALUE_SUM_Q1.New_root = CALCULATION_Q1.New_root SET CALCULATION_Q1.Asset_value = [tmp_VALUE_SUM_Q1]![Sum_of_value];"
        DoCmd.RunSQL (sqlrun)
        
    'Asset val excl cash
        ' Creating temporary table
        sqlrun = "SELECT AAA_AUM_Q1.New_root, Sum(AAA_AUM_Q1.value) AS Sum_of_val_excl_cash INTO tmp_VAL_SUM_EXCL_CASH_Q1 FROM AAA_AUM_Q1 WHERE (((AAA_AUM_Q1.category1) <> ""CASH"")) GROUP BY AAA_AUM_Q1.New_root;"
        DoCmd.RunSQL (sqlrun)
        
        ' Placing contents of temporary table onto Calculation table
        sqlrun = "UPDATE tmp_VAL_SUM_EXCL_CASH_Q1 INNER JOIN CALCULATION_Q1 ON tmp_VAL_SUM_EXCL_CASH_Q1.New_root = CALCULATION_Q1.New_root SET CALCULATION_Q1.Ass_val_excl_cash = [tmp_VAL_SUM_EXCL_CASH_Q1]![Sum_of_val_excl_cash];"
        DoCmd.RunSQL (sqlrun)









    'BPPA_SC/IM
        ' Update BPPA_SC in Calc_Q1 - not working (using joins)
        ' UPDATE FEES_GENERATED_ANS_Q1, AAA_AUM_Q1, CALCULATION_Q1 INNER JOIN STATIC_DATA ON CALCULATION_Q1.Root = STATIC_DATA.[Portfolio Code] SET CALCULATION_Q1.BPPA_SC = [STATIC_DATA].[BPPA];
        ' UPDATE FEES_GENERATED_ANS_Q1, AAA_AUM_Q1, CALCULATION_Q1 INNER JOIN STATIC_DATA ON CALCULATION_Q1.Root = STATIC_DATA.[Portfolio Code] SET CALCULATION_Q1.BPPA_SC = [STATIC_DATA].[BPPA] WHERE [STATIC_DATA].[Charge Type]="Safe Custody Fee";
        ' ^ Just hangs halfway



        'Converting AMOUNT column from negative to positive (applies only to 1&2Q16):
        sqlrun = "UPDATE FEES_GENERATED_ANS_Q1 SET FEES_GENERATED_ANS_Q1.AMOUNT = Abs([FEES_GENERATED_ANS_Q1].[AMOUNT]);"
        DoCmd.RunSQL (sqlrun)















' ===================================================================

'Q2
    'New_root
        ' Inserting root into New_root col:
        sqlrun = "INSERT INTO CALCULATION_Q2 (New_root) SELECT DISTINCT New_root FROM AAA_AUM_Q2;"
        DoCmd.RunSQL (sqlrun)

    'Asset_value
        ' Creating temporary table
        sqlrun = "SELECT AAA_AUM_Q2.New_root, Sum(AAA_AUM_Q2.value) AS Sum_of_value INTO tmp_VALUE_SUM_Q2 FROM AAA_AUM_Q2 GROUP BY AAA_AUM_Q2.New_root;"
        DoCmd.RunSQL (sqlrun)

        ' Placing contents of temporary table onto Calculation table
        sqlrun = "UPDATE tmp_VALUE_SUM_Q2 INNER JOIN CALCULATION_Q2 ON tmp_VALUE_SUM_Q2.New_root = CALCULATION_Q2.New_root SET CALCULATION_Q2.Asset_value = [tmp_VALUE_SUM_Q2]![Sum_of_value];"
        DoCmd.RunSQL (sqlrun)

    'Asset_val_excl_cash
        ' Creating temporary table
        sqlrun = "SELECT AAA_AUM_Q2.New_root, Sum(AAA_AUM_Q2.value) AS Sum_of_val_excl_cash INTO tmp_VAL_SUM_EXCL_CASH_Q2 FROM AAA_AUM_Q2 WHERE (((AAA_AUM_Q2.category1) <> ""CASH"")) GROUP BY AAA_AUM_Q2.New_root;"
        DoCmd.RunSQL (sqlrun)

        ' Placing contents of temporary table onto Calculation table
        sqlrun = "UPDATE tmp_VAL_SUM_EXCL_CASH_Q2 INNER JOIN CALCULATION_Q2 ON tmp_VAL_SUM_EXCL_CASH_Q2.New_root = CALCULATION_Q2.New_root SET CALCULATION_Q2.Ass_val_excl_cash = [tmp_VAL_SUM_EXCL_CASH_Q2]![Sum_of_val_excl_cash];"
        DoCmd.RunSQL (sqlrun)








        ' Converting AMOUNT column from negative to positive (applies only to 1&2Q16):
        sqlrun = "UPDATE FEES_GENERATED_ANS_Q2 SET FEES_GENERATED_ANS_Q2.AMOUNT = Abs([FEES_GENERATED_ANS_Q2].[AMOUNT]);"
        DoCmd.RunSQL (sqlrun)








' ===================================================================

'Q3
    'New_root
        ' Inserting root into New_root col:
        sqlrun = "INSERT INTO CALCULATION_Q3 (New_root) SELECT DISTINCT New_root FROM AAA_AUM_Q3;"
        DoCmd.RunSQL (sqlrun)

    'Asset value
        ' Creating temporary table
        sqlrun = "SELECT AAA_AUM_Q3.New_root, Sum(AAA_AUM_Q3.value) AS Sum_of_value INTO tmp_VALUE_SUM_Q3 FROM AAA_AUM_Q3 GROUP BY AAA_AUM_Q3.New_root;"
        DoCmd.RunSQL (sqlrun)
        
        ' Placing contents of temporary table onto Calculation table
        sqlrun = "UPDATE tmp_VALUE_SUM_Q3 INNER JOIN CALCULATION_Q3 ON tmp_VALUE_SUM_Q3.New_root = CALCULATION_Q3.New_root SET CALCULATION_Q3.Asset_value = [tmp_VALUE_SUM_Q3]![Sum_of_value];"
        DoCmd.RunSQL (sqlrun)
        
    'Asset val excl cash
        ' Creating temporary table
        sqlrun = "SELECT AAA_AUM_Q3.New_root, Sum(AAA_AUM_Q3.value) AS Sum_of_val_excl_cash INTO tmp_VAL_SUM_EXCL_CASH_Q3 FROM AAA_AUM_Q3 WHERE (((AAA_AUM_Q3.category1) <> ""CASH"")) GROUP BY AAA_AUM_Q3.New_root;"
        DoCmd.RunSQL (sqlrun)
        
        ' Placing contents of temporary table onto Calculation table
        sqlrun = "UPDATE tmp_VAL_SUM_EXCL_CASH_Q3 INNER JOIN CALCULATION_Q3 ON tmp_VAL_SUM_EXCL_CASH_Q3.New_root = CALCULATION_Q3.New_root SET CALCULATION_Q3.Ass_val_excl_cash = [tmp_VAL_SUM_EXCL_CASH_Q3]![Sum_of_val_excl_cash];"
        DoCmd.RunSQL (sqlrun)









    DoCmd.SetWarnings True
    
End Sub

